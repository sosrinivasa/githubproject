<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Commerce Simulation</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .product, .vendor-product { border: 1px solid #ddd; padding: 10px; margin: 10px; display: inline-block; width: 200px; }
        .cart, .vendor-section, .order-history { margin-top: 20px; }
        .vendor-section input, .vendor-section button { margin: 5px 0; }
        input[type="text"], input[type="number"], select { width: 100%; padding: 8px; }
    </style>
</head>
<body>

    <h1>Welcome to E-Commerce Website</h1>
    
    <h2>Product Search & Filter</h2>
    <input type="text" id="search" placeholder="Search products..." oninput="filterProducts()">
    <select id="categoryFilter" onchange="filterProducts()">
        <option value="">All Categories</option>
        <option value="Electronics">Gadgets</option>
        <option value="Clothing">Dresses</option>
        <option value="Home">Home</option>
    </select>
    <input type="number" id="priceFilter" placeholder="Max Price" oninput="filterProducts()">
    
    <div id="products"></div>

    <h2>Cart</h2>
    <div id="cart" class="cart">
        <p>Cart is empty</p>
    </div>
    <button onclick="checkout()">Checkout</button>
    
    <h2>Vendor Section</h2>
    <div class="vendor-section">
        <h3>Add/Edit Product</h3>
        <input type="text" id="productTitle" placeholder="Product Title">
        <input type="text" id="productDescription" placeholder="Description">
        <input type="number" id="productPrice" placeholder="Price">
        <input type="text" id="productCategory" placeholder="Category">
        <input type="text" id="productImage" placeholder="Image URL">
        <button onclick="addOrUpdateVendorProduct()">Add/Update Product</button>
        
        <h3>Vendor Products</h3>
        <div id="vendorProducts"></div>
        
        <h3>Sales History</h3>
        <div id="salesHistory">
            <p>No sales history available.</p>
        </div>
    </div>
    
    <h2>Order History</h2>
    <div id="orderHistory" class="order-history">
        <p>No orders yet.</p>
    </div>
    
    <script>
        // Initialize storage variables
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let orders = JSON.parse(localStorage.getItem('orders')) || [];
        let vendorProducts = JSON.parse(localStorage.getItem('vendorProducts')) || [];
        let salesHistory = JSON.parse(localStorage.getItem('salesHistory')) || [];
        let editingProductIndex = null;  // Track the product being edited

        // Display all vendor products
        function displayVendorProducts() {
            const vendorDiv = document.getElementById("vendorProducts");
            if (vendorProducts.length === 0) {
                vendorDiv.innerHTML = "<p>No products added.</p>";
                return;
            }
            vendorDiv.innerHTML = vendorProducts.map((product, index) => `
                <div class="vendor-product">
                    <h4>${product.title}</h4>
                    <p>${product.description}</p>
                    <p>Price: ₹${product.price}</p>
                    <p>Category: ${product.category}</p>
                    <img src="${product.image}" alt="${product.title}" style="width:100px;">
                    <button onclick="editVendorProduct(${index})">Edit</button>
                    <button onclick="deleteVendorProduct(${index})">Delete</button>
                </div>
            `).join('');
        }

        // Add or Update a product in the vendor's catalog
        function addOrUpdateVendorProduct() {
            const title = document.getElementById("productTitle").value;
            const description = document.getElementById("productDescription").value;
            const price = document.getElementById("productPrice").value;
            const category = document.getElementById("productCategory").value;
            const image = document.getElementById("productImage").value;

            if (title && price) {
                const product = { title, description, price, category, image };
                if (editingProductIndex !== null) {
                    // Update existing product
                    vendorProducts[editingProductIndex] = product;
                    editingProductIndex = null;  // Reset editing state
                } else {
                    // Add new product
                    vendorProducts.push(product);
                }
                localStorage.setItem('vendorProducts', JSON.stringify(vendorProducts));
                displayVendorProducts();
                resetProductForm();
            }
        }

        // Edit a product from the catalog
        function editVendorProduct(index) {
            const product = vendorProducts[index];
            document.getElementById("productTitle").value = product.title;
            document.getElementById("productDescription").value = product.description;
            document.getElementById("productPrice").value = product.price;
            document.getElementById("productCategory").value = product.category;
            document.getElementById("productImage").value = product.image;
            editingProductIndex = index;  // Set the product index for editing
        }

        // Delete a product from vendor's catalog
        function deleteVendorProduct(index) {
            vendorProducts.splice(index, 1);
            localStorage.setItem('vendorProducts', JSON.stringify(vendorProducts));
            displayVendorProducts();
        }

        // Filter products based on search and filter criteria
        function filterProducts() {
            const search = document.getElementById("search").value.toLowerCase();
            const category = document.getElementById("categoryFilter").value;
            const maxPrice = document.getElementById("priceFilter").value;

            const filteredProducts = vendorProducts.filter(p => {
                const matchesSearch = p.title.toLowerCase().includes(search);
                const matchesCategory = category ? p.category === category : true;
                const matchesPrice = maxPrice ? p.price <= maxPrice : true;
                return matchesSearch && matchesCategory && matchesPrice;
            });

            displayProducts(filteredProducts);
        }

        // Display filtered products to the user
        function displayProducts(products) {
            const productsDiv = document.getElementById("products");
            if (products.length === 0) {
                productsDiv.innerHTML = "<p>No products found.</p>";
                return;
            }

            productsDiv.innerHTML = products.map(p => `
                <div class="product">
                    <h4>${p.title}</h4>
                    <p>Price: ₹${p.price}</p>
                    <button onclick="addToCart('${p.title}', ${p.price})">Add to Cart</button>
                </div>
            `).join('');
        }

        // Add product to cart
        function addToCart(name, price) {
            cart.push({ name, price });
            localStorage.setItem('cart', JSON.stringify(cart));
            displayCart();
        }

        // Display the cart
        function displayCart() {
            const cartDiv = document.getElementById("cart");
            if (cart.length === 0) {
                cartDiv.innerHTML = "<p>Cart is empty</p>";
                return;
            }
            cartDiv.innerHTML = cart.map(item => `
                <p>${item.name} - ₹${item.price} <button onclick="removeFromCart('${item.name}')">Remove</button></p>
            `).join('');
        }

        // Remove product from cart
        function removeFromCart(name) {
            cart = cart.filter(item => item.name !== name);
            localStorage.setItem('cart', JSON.stringify(cart));
            displayCart();
        }

        // Checkout and create order
        function checkout() {
            if (cart.length > 0) {
                const order = { id: Date.now(), items: [...cart], timestamp: new Date().toLocaleString() };
                orders.push(order);
                localStorage.setItem('orders', JSON.stringify(orders));
                displayOrderHistory();
                cart = [];
                localStorage.setItem('cart', JSON.stringify(cart));
                displayCart();
                updateSalesHistory(order);
            }
        }

        // Display order history
        function displayOrderHistory() {
            const orderDiv = document.getElementById("orderHistory");
            if (orders.length === 0) {
                orderDiv.innerHTML = "<p>No orders yet.</p>";
                return;
            }
            orderDiv.innerHTML = orders.map(order => `
                <div>
                    <p>Order ID: ${order.id}</p>
                    <p>Timestamp: ${order.timestamp}</p>
                    <p>Items:</p>
                    <ul>
                        ${order.items.map(item => `<li>${item.name} - ₹${item.price}</li>`).join('')}
                    </ul>
                </div>
            `).join('');
        }

        // Update sales history for vendor
        function updateSalesHistory(order) {
            order.items.forEach(item => {
                const productSale = { product: item.name, timestamp: order.timestamp, price: item.price };
                salesHistory.push(productSale);
            });
            localStorage.setItem('salesHistory', JSON.stringify(salesHistory));
            displaySalesHistory();
        }

        // Display sales history for the vendor
        function displaySalesHistory() {
            const salesDiv = document.getElementById("salesHistory");
            if (salesHistory.length === 0) {
                salesDiv.innerHTML = "<p>No sales history available.</p>";
                return;
            }
            salesDiv.innerHTML = salesHistory.map(sale => `
                <p>Product: ${sale.product}, Price: ₹${sale.price}, Sold at: ${sale.timestamp}</p>
            `).join('');
        }

        // Reset the form for adding/editing product
        function resetProductForm() {
            document.getElementById("productTitle").value = '';
            document.getElementById("productDescription").value = '';
            document.getElementById("productPrice").value = '';
            document.getElementById("productCategory").value = '';
            document.getElementById("productImage").value = '';
        }

        // Initialize the application
        window.onload = function() {
            displayVendorProducts();
            displayCart();
            displayOrderHistory();
            displaySalesHistory();
            filterProducts();
        };
    </script>

</body>
</html>